<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/styles.css" />
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
    />
    <title>Practica 2 App. Mov.</title>
    <script
      src="https://code.jquery.com/jquery-3.5.0.min.js"
      integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <header>
      <div class="header">
        <div class="logo">
          <a><img src="img/logo_22.png" alt="logo" /></a>
        </div>
        <div class="title"><h1>The Games Club</h1></div>
        <div id="cart">
          <div>
            <i class="fas fa-shopping-cart"></i>Total:
            <span id="cart-total"></span>
          </div>
        </div>
      </div>
    </header>
    <main>
      <div class="main">
        <aside>
          <nav>
            <div class="nav">
              <h2 id="cat">Categorias</h2>
              <ul>
                <li>
                  <a class="cat-selection" id="action" href="#">Acción</a>
                </li>
                <li>
                  <a class="cat-selection" id="adventure" href="#">Aventuras</a>
                </li>
                <li>
                  <a class="cat-selection" id="race" href="#">Carreras</a>
                </li>
                <li>
                  <a href="pages/encuesta.html">Encuesta</a>
                </li>
              </ul>
            </div>
          </nav>
        </aside>
        <div class="content">
          <section>
            <div class="section" id="action-section">
              <h2>Accion</h2>
              <div class="items">
                <article id="123">
                  <img
                    class="product-image"
                    src="img/products/battlefield.jpg"
                    alt="battlefield"
                  />
                  <h4>Battlefield</h4>
                  <p>
                    El juego se centra en un hipotético conflicto armado de
                    finales del siglo XXI, cuando tres facciones se enfrentan:
                    Estados Unidos, China y la coalición de estados de Medio
                    Oriente. Por supuesto, cada lado tiene un rico arsenal de
                    municiones, incluyendo armas pequeñas (rifle M-4, pistola
                    M-9, etc.)
                  </p>
                  <span class="price">Precio: $ 32</span>
                  <button class="addtocart-btn">Agregar al carrito</button>
                  <button class="takeout-fromcart-btn">
                    Quitar del carrito
                  </button>
                </article>
              </div>
            </div>
          </section>
          <section>
            <div class="section" id="adventure-section">
              <h2>Aventuras</h2>
              <div class="items"></div>
            </div>
          </section>
          <section>
            <div class="section" id="race-section">
              <h2>Carreras</h2>
              <div class="items"></div>
            </div>
          </section>
        </div>
      </div>
    </main>
    <footer>
      <div class="footer">
        All rights are not reserved &copy; because we are based on OpenSource
      </div>
    </footer>
    <script>
      const games = [];
      const cart = [];
      var total = 0;

      const recalculateTotal = () => {
        total = 0;
        for (const game of cart) {
          total += game.price;
        }
        console.log(total);
        $("#cart-total").html(total);
      };

      const hideAll = () => {
        $(".section").each(function () {
          $(this).addClass("hidden");
        });
      };

      const handleAddBtnClick = (e, gameId) => {
        console.log("adding to cart: ", gameId);
        const gameFound = games.find((x) => x.id === gameId);
        cart.push(gameFound);

        // turn img opac
        $(e.target).parent().find($("img")).addClass("opacity");

        console.log(cart);
        recalculateTotal();
      };

      const handleTakeOutBtnClick = (e, gameId) => {
        cart.splice(
          cart.findIndex((x) => x.id === gameId),
          1
        );

        // remove img opacity
        $(e.target).parent().find($("img")).removeClass("opacity");

        console.log(cart);
        recalculateTotal();
      };

      const buildArticles = (gameList) => {
        for (const game of gameList) {
          const img = document.createElement("img");
          $(img)
            .addClass("product-image")
            .attr("src", game.picture)
            .attr("alt", game.title);

          const article = document.createElement("article");

          const addBtn = document.createElement("button");
          $(addBtn)
            .addClass("add-btn")
            .html("Agregar al carrito")
            .attr("onclick", `handleAddBtnClick(event, ${game.id})`);

          const takeOutBtn = document.createElement("button");
          $(takeOutBtn)
            .addClass("takeout-btn")
            .html("Quitar del carrito")
            .attr("onclick", `handleTakeOutBtnClick(event, ${game.id})`);

          $(article)
            .attr("id", `article-${game.id}`)
            .addClass("article")
            .append(img)
            .append(`<h4>${game.title}</h4>`)
            .append(`<p>${game.about}</p>`)
            .append(`<span class="price"">$ ${game.price}</span>`)
            .append(addBtn)
            .append(takeOutBtn);

          $(`#${game.category}-section .items`).append(article);
          games.push(game);
        }
      };

      const fetchData = (url) => {
        $.get(url, function (data) {
          console.log(data);
          buildArticles(data);
        });
      };
      // init
      fetchData(
        "http://www.json-generator.com/api/json/get/bVJXfwuXKG?indent=2"
      );
      hideAll();

      // ready
      $(document).ready(function () {
        $("#cart-total").html(total);
        $(".cat-selection").click(function () {
          hideAll();
          // show
          $(`#${$(this).attr("id")}-section`).removeClass("hidden");
        });
      });
    </script>
  </body>
</html>
